{% extends 'base/base.html' %}
{% load static %}

{% block title %}Detalle del Gasto Compartido{% endblock %}

{% block extra_head %}
    <link rel="stylesheet" href="{% static 'css/gastos_compartidos.css' %}">
{% endblock %}

{% block content %}
<div class="gastos-container">
    <!-- Header -->
    <div class="page-header">
        <h1><i class="fas fa-eye text-primary"></i> Detalle del Gasto Compartido</h1>
        <div class="btn-group">
            <a href="{% url 'gastos_compartidos_lista' %}" class="btn-secondary">
                <i class="fas fa-arrow-left"></i> Volver
            </a>
            <a href="{% url 'gasto_compartido_editar' gasto.pk %}" class="btn-warning">
                <i class="fas fa-edit"></i> Editar
            </a>
        </div>
    </div>

    <div class="row">
        <!-- Información Principal -->
        <div class="col-lg-8 mb-4">
            <div class="card">
                <div class="card-header">
                    <h2><i class="fas fa-receipt"></i> {{ gasto.titulo }}</h2>
                </div>
                <div class="card-body">
                    <div class="form-grid">
                        <div class="form-section">
                            <h3><i class="fas fa-info-circle"></i> Información Básica</h3>
                            <p><strong>Tipo:</strong> {{ gasto.get_tipo_display }}</p>
                            <p><strong>Estado:</strong> 
                                {% if gasto.estado == 'pagado' %}
                                    <span class="badge bg-success">Pagado</span>
                                {% elif gasto.estado == 'pendiente' %}
                                    <span class="badge bg-warning">Pendiente</span>
                                {% elif gasto.estado == 'vencido' %}
                                    <span class="badge bg-danger">Vencido</span>
                                {% else %}
                                    <span class="badge bg-secondary">{{ gasto.get_estado_display }}</span>
                                {% endif %}
                            </p>
                            <p><strong>Fecha:</strong> {{ gasto.fecha|date:"d/m/Y" }}</p>
                            {% if gasto.fecha_vencimiento %}
                                <p><strong>Vence:</strong> {{ gasto.fecha_vencimiento|date:"d/m/Y" }}</p>
                            {% endif %}
                        </div>

                        <div class="form-section">
                            <h3><i class="fas fa-dollar-sign"></i> Información Financiera</h3>
                            <p><strong>Monto Total:</strong> ${{ gasto.monto_total|floatformat:2 }}</p>
                            <p><strong>Por Persona:</strong> ${{ gasto.monto_por_persona|floatformat:2 }}</p>
                            {% if gasto.pagado_por %}
                                <p><strong>Pagado por:</strong> {{ gasto.pagado_por.get_full_name|default:gasto.pagado_por.username }}</p>
                            {% endif %}
                        </div>
                    </div>

                    {% if gasto.descripcion %}
                    <div class="form-section">
                        <h3><i class="fas fa-align-left"></i> Descripción</h3>
                        <p>{{ gasto.descripcion }}</p>
                    </div>
                    {% endif %}

                    {% if gasto.comprobante %}
                    <div class="form-section">
                        <h3><i class="fas fa-paperclip"></i> Comprobante</h3>
                        <img src="{{ gasto.comprobante.url }}" alt="Comprobante" class="img-fluid" style="max-width: 300px;">
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Información del Grupo -->
        <div class="col-lg-4 mb-4">
            <div class="card">
                <div class="card-header" style="background: {{ gasto.grupo.color }};">
                    <h3><i class="fas fa-users"></i> {{ gasto.grupo.nombre }}</h3>
                </div>
                <div class="card-body">
                    <p><strong>Miembros:</strong> {{ gasto.grupo.cantidad_miembros }}</p>
                    <p><strong>Creado por:</strong> {{ gasto.grupo.creador.get_full_name|default:gasto.grupo.creador.username }}</p>
                    <p><strong>Fecha creación:</strong> {{ gasto.grupo.fecha_creacion|date:"d/m/Y" }}</p>
                    
                    <div class="mt-3">
                        <a href="{% url 'saldos_grupo' gasto.grupo.pk %}" class="btn-primary">
                            <i class="fas fa-balance-scale"></i> Ver Saldos
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Pagos de Miembros -->
    <div class="card">
        <div class="card-header">
            <h3><i class="fas fa-credit-card"></i> Pagos de Miembros</h3>
        </div>
        <div class="card-body">
            {% if pagos %}
                <div class="table-responsive">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Miembro</th>
                                <th>Monto Debido</th>
                                <th>Monto Pagado</th>
                                <th>Estado</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for pago in pagos %}
                            <tr>
                                <td>
                                    <strong>{{ pago.miembro.get_full_name|default:pago.miembro.username }}</strong>
                                </td>
                                <td>${{ pago.monto_debido|floatformat:2 }}</td>
                                <td>${{ pago.monto_pagado|floatformat:2 }}</td>
                                <td>
                                    {% if pago.estado == 'pagado' %}
                                        <span class="badge bg-success">Pagado</span>
                                    {% elif pago.estado == 'parcial' %}
                                        <span class="badge bg-warning">Parcial</span>
                                    {% else %}
                                        <span class="badge bg-danger">Pendiente</span>
                                    {% endif %}
                                </td>
                                <td>
                                    {% if pago.miembro == request.user %}
                                        <a href="{% url 'pago_gasto_compartido_editar' pago.pk %}" class="btn-warning btn-sm">
                                            <i class="fas fa-edit"></i> Editar Pago
                                        </a>
                                    {% else %}
                                        <span class="text-muted">No puedes editar</span>
                                    {% endif %}
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            {% else %}
                <div class="empty-state">
                    <div class="empty-icon">💳</div>
                    <h3>No hay pagos registrados</h3>
                    <p class="text-muted mb-4">Aún no se han registrado pagos para este gasto.</p>
                </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %} 